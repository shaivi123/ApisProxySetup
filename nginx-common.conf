worker_processes 1;

# error_log logs/error.log debug;

events {
    worker_connections 1024;
}

http {
    upstream us_backend {
        server apisproxysetup-us-nordvpn-1:8001;  # Replace with actual container name
    }

    upstream italy_backend {
        server apisproxysetup-italy-nordvpn-1:8002;  # Replace with actual container name
    }

    upstream japan_backend {
        server apisproxysetup-japan-nordvpn-1:8003;  # Replace with actual container name
    }

    upstream germany_backend {
        server apisproxysetup-germany-nordvpn-1:8004;  # Replace with actual container name
    }

    upstream canada_backend {
        server apisproxysetup-canada-nordvpn-1:8005;  # Replace with actual container name
    }

    upstream spain_backend {
        server apisproxysetup-spain-nordvpn-1:8006;  # Replace with actual container name
    }

    upstream brazil_backend {
        server apisproxysetup-brazil-nordvpn-1:8007;  # Replace with actual container name
    }

    upstream ireland_backend {
        server apisproxysetup-ireland-nordvpn-1:8008;  # Replace with actual container name
    }

    upstream srilanka_backend {
        server apisproxysetup-srilanka-nordvpn-1:8009;  # Replace with actual container name
    }

    upstream pakistan_backend {
        server apisproxysetup-pakistan-nordvpn-1:8010;  # Replace with actual container name
    }

    # upstream india_backend {
    #     server apisproxysetup-india-nordvpn-1:8011;  # Replace with actual container name
    # }

    # upstream bangladesh_backend {
    #     server apisproxysetup-bangladesh-nordvpn-1:8012;  # Replace with actual container name
    # }

    server {
        listen 80;

        location / {
            set $backend "";

            if ($http_country_param = "US") {
                set $backend "us_backend";
            }

            if ($http_country_param = "Italy") {
                set $backend "italy_backend";
            }

            if ($http_country_param = "Japan") {
                set $backend "japan_backend";
            }

            if ($http_country_param = "Germany") {
                set $backend "germany_backend";
            }

            if ($http_country_param = "Canada") {
                set $backend "canada_backend";
            }

            if ($http_country_param = "Spain") {
                set $backend "spain_backend";
            }

            if ($http_country_param = "Brazil") {
                set $backend "brazil_backend";
            }

            if ($http_country_param = "Ireland") {
                set $backend "ireland_backend";
            }

            if ($http_country_param = "SriLanka") {
                set $backend "srilanka_backend";
            }

            if ($http_country_param = "Pakistan") {
                set $backend "pakistan_backend";
            }

            # if ($http_country_param = "India") {
            #     set $backend "india_backend";
            # }

            # if ($http_country_param = "Bangladesh") {
            #     set $backend "bangladesh_backend";
            # }

            if ($backend = "") {
                return 400 "Invalid country parameter";
            }

            proxy_pass http://$backend;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
            proxy_set_header X-Forwarded-Proto $scheme;
            proxy_set_header X-Proxy-URL $http_x_proxy_url;
            proxy_set_header X-Proxy-Host $http_x_proxy_host;
        }
    }
}
